{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; <a href="{% url 'admin:agni_storedextractionsession_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
    &rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}

<!-- Hidden CSRF token for React to access -->
{% csrf_token %}

<div id="agni-document-processing"></div>

<div id="agni-ui-error" style="display: none;">
    <div style="max-width: 800px; margin: 40px auto; padding: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">
        <h2 style="color: #856404; margin-top: 0;">⚠️ Agni UI Not Available</h2>
        <p style="color: #856404; line-height: 1.6;">
            The Agni UI was expected to be running at <strong id="agni-ui-url"></strong> but could not be found.
        </p>
        <p style="color: #856404; line-height: 1.6;">
            Please ensure the Agni UI development server is running. You can start it by running:
        </p>
        <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>cd agni-ui
npm run dev</code></pre>
    </div>
</div>

{% endblock %}

{% block extrahead %}
{{ block.super }}

{% if agni_ui_debug_url %}
    <script type="module">
    try {
        const { injectIntoGlobalHook } = await import("{{ agni_ui_debug_url }}/@react-refresh");
        injectIntoGlobalHook(window);
        window.$RefreshReg$ = () => {};
        window.$RefreshSig$ = () => (type) => type;
    } catch (e) {
        // Show error message to user
        document.getElementById('agni-ui-error').style.display = 'block';
        document.getElementById('agni-ui-url').textContent = '{{ agni_ui_debug_url }}';
        document.getElementById('agni-document-processing').style.display = 'none';
    }
    </script>
    <script type="module" src="{{ agni_ui_debug_url }}/@vite/client"></script>

    <script type="module" src="{{ agni_ui_debug_url }}/src/main.jsx"></script>
{% else %}
    <!-- Production: Load built agni-ui assets -->
    <link rel="stylesheet" type="text/css" href="{% static 'agni/ui/assets/index.css' %}">
    <script type="module" src="{% static 'agni/ui/assets/index.js' %}"></script>
{% endif %}

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="{% static 'agni/css/upload_document.css' %}">

{% endblock %}